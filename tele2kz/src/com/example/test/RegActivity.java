package com.example.test;

import java.net.CookieHandler;
import java.net.CookieManager;
import kz.alfa.map.R;
import android.annotation.SuppressLint;
import android.app.Activity;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.os.AsyncTask;
import android.os.Bundle;
import android.preference.PreferenceManager;
import com.example.test.util.Log;
import android.view.View;
import android.webkit.WebView;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.TextView;
import android.widget.Toast;

public class RegActivity extends Activity {
	private static long last_login = 0;
	private static CookieManager cookieManager;
	
	private EditText edNumbCap;
	private SharedPreferences sp;
	private TextView tvWait, tvErrorReg, tvNubm;
	private Button btnEnter;
	private ImageButton onRefresh;
	private	WebView webView;

	public static String tele2_url_login   = "https://iself.tele2.kz/";
	public static String tele2_url_captcha = "https://iself.tele2.kz/captcha";
	public static String tele2_url_chk_ms  = "https://iself.tele2.kz/auth/checkMsisdn";
	public static String tele2_url_auth_reg= "https://iself.tele2.kz/auth/reg";
	
		
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_reg);
		sp = PreferenceManager.getDefaultSharedPreferences(this);

		webView = (WebView) findViewById(R.id.webView);;

		edNumbCap = (EditText) findViewById(R.id.edNumbCap);

		tvWait = (TextView) findViewById(R.id.tvWaitReg);
		tvErrorReg = (TextView) findViewById(R.id.tvErrorReg);
		tvNubm = (TextView) findViewById(R.id.tvNubm);
		
		btnEnter = (Button) findViewById(R.id.btn_enter);
		onRefresh = (ImageButton) findViewById(R.id.onRefresh);
		
	}

	// log in start process
	public void click(View view) {
		onPause();
		new synAuthReg().execute();
	}

	protected void onResume() {
		tvNubm.setText("+7 "+sp.getString("edNumb", ""));
		edNumbCap.setText(sp.getString("edNumbCap", ""));
		if ((System.currentTimeMillis()-last_login) > 5*60*1000l){
			cookieManager = new CookieManager();
			CookieHandler.setDefault(cookieManager);
			
			new synToken().execute();
			webView.loadData(" &#8230; "			
					, "text/html", "UTF-8");
			btnEnter.setEnabled(false);
			onRefresh.setEnabled(false);
		} else {
			webView.loadData("<img src=\"" + sp.getString("captcha", "") + "\" />"			
				, "text/html", "UTF-8");
			if (cookieManager != null){
				CookieHandler.setDefault(cookieManager);
				
				btnEnter.setEnabled(true);
				onRefresh.setEnabled(true);
			}
		}
		super.onResume();
	}

	protected void onPause() {
		Editor ed = sp.edit();
		ed.putString("edNumbCap", edNumbCap.getText().toString());
		ed.commit();
		super.onPause();
	}

	public void onRefresh(View v) {
		new synCaptcha().execute();
	}
	
	private class synToken extends AsyncTask<Void, Void, String> {

		@Override
		protected void onPreExecute() {
			Log.v("synToken", "onPreExecute start ");
			tvWait.setVisibility(TextView.VISIBLE);
			tvErrorReg.setVisibility(TextView.GONE);
			onRefresh.setEnabled(false);
			btnEnter.setEnabled(false);
			super.onPreExecute();
		}

		@Override
		protected String doInBackground(Void... params) {
			Log.v("synToken", "doInBackground start");
			try {
				String data = ((new HttpClient()).getDataHttps(tele2_url_login));
				Log.v("synToken", "result bytes = " + data.length());
				return data;
			} catch (Exception e) {
				e.printStackTrace();
				Log.v("synToken", "doInBackground error  " + e.toString());
			} finally {
				Log.v("synToken", "doInBackground finally  ");
			}
			return "";
		}

		@SuppressLint("SimpleDateFormat")
		@Override
		protected void onPostExecute(String result) {
			super.onPostExecute(result);
			tvWait.setVisibility(TextView.GONE);
			onRefresh.setEnabled(true);
			btnEnter.setEnabled(true);
			Log.v("synToken", "onPostExecute start result len = " + result.length());
			if (result != null && result.length() > 0) {
				tvErrorReg.setVisibility(TextView.GONE);			
				String res = json_par.get_token(result);
				Log.v("synToken", "onPostExecute res= " + res);
				Log.v("synToken", "onPostExecute res len = " + res.length());
				if (res != null && res.length() > 10) {
					Editor ed = sp.edit();
					ed.putString("token", res);
					last_login = System.currentTimeMillis();

					ed.commit();
					Log.v("synToken", "onPostExecute I have got token = " + res);
					new synCaptcha().execute();
				} else
					tvErrorReg.setVisibility(TextView.VISIBLE);
			} else {
				tvErrorReg.setVisibility(TextView.VISIBLE);
			}
		}
	}


	private class synCaptcha extends AsyncTask<Void, Void, String> {

		@Override
		protected void onPreExecute() {
			Log.v("synCaptcha", "onPreExecute start ");
			tvWait.setVisibility(TextView.VISIBLE);
			tvErrorReg.setVisibility(TextView.GONE);
			onRefresh.setEnabled(false);
			btnEnter.setEnabled(false);
			super.onPreExecute();
		}

		@Override
		protected String doInBackground(Void... params) {
			Log.v("synCaptcha", "doInBackground start");
			try {
				String data = ((new HttpClient()).getPOSTAJAX_https(tele2_url_captcha,
							json_par.create_token(sp.getString("token", "")
						)));
				Log.v("synCaptcha", "result bytes = " + data.length());
				return data;
			} catch (Exception e) {
				e.printStackTrace();
				Log.v("synCaptcha", "doInBackground error  " + e.toString());
			} finally {
				Log.v("synCaptcha", "doInBackground finally  ");
			}
			return "";
		}

		@SuppressLint("SimpleDateFormat")
		@Override
		protected void onPostExecute(String result) {
			super.onPostExecute(result);
			tvWait.setVisibility(TextView.GONE);
			onRefresh.setEnabled(true);
			btnEnter.setEnabled(true);
			Log.v("synCaptcha", "onPostExecute start result len = " + result.length());
			if (result != null && result.length() > 10) {
				Log.v("synCaptcha", "onPostExecute start result  = " + result.substring(1, 200));
				String captcha = json_par.get_captcha(result);
				Log.v("synCaptcha", "onPostExecute captcha  = " + captcha.substring(1, 200));
				if (captcha.indexOf("error") < 0){
					Editor ed = sp.edit();
					ed.putString("captcha", captcha);
					ed.putString("edNumbCap", "");
					ed.commit();
					onResume();
					edNumbCap.setText("");
				} else
					tvErrorReg.setVisibility(TextView.VISIBLE);
			}
		}
	}


	private class synAuthReg extends AsyncTask<Void, Void, String> {

		@Override
		protected void onPreExecute() {
			Log.v("synAuthReg", "onPreExecute start ");
			tvWait.setVisibility(TextView.VISIBLE);
			tvErrorReg.setVisibility(TextView.GONE);
			onRefresh.setEnabled(false);
			btnEnter.setEnabled(false);
			super.onPreExecute();
		}

		@Override
		protected String doInBackground(Void... params) {
			Log.v("synAuthReg", "doInBackground start");
			try {
				String data = ((new HttpClient()).getPOSTAJAX_https(tele2_url_auth_reg,
							json_par.create_AuthReg(sp.getString("edNumb", "")
									, sp.getString("token", "")
									, sp.getString("edNumbCap", "") 
						)));
				Log.v("synAuthReg", "result bytes = " + data.length());
				return data;
			} catch (Exception e) {
				e.printStackTrace();
				Log.v("synAuthReg", "doInBackground error  " + e.toString());
			} finally {
				Log.v("synAuthReg", "doInBackground finally  ");
			}
			return "";
		}

		@SuppressLint("SimpleDateFormat")
		@Override
		protected void onPostExecute(String result) {
			super.onPostExecute(result);
			tvWait.setVisibility(TextView.GONE);
			onRefresh.setEnabled(true);
			btnEnter.setEnabled(true);
			Log.v("synAuthReg", "onPostExecute start result len = " + result.length());
			if (result != null && result.length() > 10) {
				Log.v("synAuthReg", "onPostExecute start result  = " + result);
				if (result.indexOf("{\"oResult\":[\"0\"],\"type\":\"sms\"}") >= 0){
					
					Toast.makeText(getBaseContext(), getString(R.string.label_reg_sms_sent)
							, Toast.LENGTH_LONG).show();
					finish();
				} else{
					tvErrorReg.setVisibility(TextView.VISIBLE);
					edNumbCap.setText("");
				}
			}
		}
	}


}
/*
 * 
URL запроса: 	https://iself.tele2.kz/captcha
Метод запроса: 	POST
Код состояния: 	HTTP/1.1 200 OK
Заголовки запроса 11:34:11.000
User-Agent:	Mozilla/5.0 (Windows NT 6.1; rv:42.0) Gecko/20100101 Firefox/42.0
Referer:	https://iself.tele2.kz/login
Pragma:	no-cache
Host:	iself.tele2.kz
DNT:	1
Content-Type:	application/json;charset=utf-8
Content-Length:	64
Connection:	keep-alive
Cache-Control:	no-cache
Accept-Language:	ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding:	gzip, deflate
Accept:	application/json, text/plain, /*
Отправленная кука
sid:	Z3d1r8ihXCFwOaS6v5ScgzKFSibftskP90EBzidaTcCqFpLpCaoQuSUd01g9bsQM1rJF1iNQVKn4hyxmrg8f7iLxiM5Ub1oqHwEQuhyJhu6n9HAuZZnl9ZiPJsDiWQlf
region:	almaty
NG_TRANSLATE_LANG_KEY:	"kz_KZ"
lang:	ru
_ym_visorc_32627145:	w
_ym_uid:	1472521515929940391
_ym_isad:	2
__utmz:	211774349.1472521518.1.1.utmcsr=w5conts.ddns.net:8080|utmccn=(referral)|utmcmd=referral|utmcct=/tst/sms/www/
__utmz:	196427305.1472566697.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)
__utmc:	211774349
__utmb:	211774349.2.10.1473653069
__utma:	211774349.1016757185.1472521518.1472951870.1473653069.4
__utma:	196427305.1295844629.1472566697.1472566697.1472566697.1
Тело запроса
{"same_origin_token":"5496131068d7dcd774aff994421e10c222d65447"}
Заголовки ответа Δ445мс
Transfer-Encoding:	chunked
Server:	nginx/0.7.61
Date:	Mon, 12 Sep 2016 04:34:10 GMT
Content-Type:	application/json; charset=UTF-8
Connection:	keep-alive
Полученная кука
sid:	Z3d1r8ihXCFwOaS6v5ScgzKFSibftskP90EBzidaTcCqFpLpCaoQuSUd01g9bsQM1rJF1iNQVKn4hyxmrg8f7iLxiM5Ub1oqHwEQuhyJhu6n9HAuZZnl9ZiPJsDiWQlf
Тело ответа Δ0мс
{"params":{"method":"POST","controller":"Captcha","action":"captcha"
,"same_origin_token":"5496131068d7dcd774aff994421e10c222d65447"}
,"capcha64":"
data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAoCAMAAAACNM4XAAAAGFBMVEUAAABQUFAAAAAAAAAAAAAAAAAAAAAAAABiRp8mAAAACHRSTlMA/wAAAAAAACXRGJEAABLzSURBVHjaAegSF+0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAQEAAAAAAAAAAAAAAAEBAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAAAAAAEBAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAQEBAQEBAQEBAQAAAAAAAAAAAAEBAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAAAAAEBAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAAAAAEBAQAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAQEAAAAAAAAAAAAAAAABAQEBAAAAAAAAAAAAAAAAAAABAQAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAQEBAQABAQEAAAAAAAAAAAABAQAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAEBAQEBAQEBAQAAAAAAAAAAAQEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAQEAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAQEBAQEBAQEBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAEBAQEBAQEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAABAQEBAQEBAQEBAQEBAQAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAABAQEBAAABAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAAAAAQEAAAAAAAAAAAABAQEAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAEBAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAEBAQAAAAABAQAAAAAAAAABAQAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAABAQEBAAABAQEBAAAAAAAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAABAQEBAQEAAAAAAAAAAAAAAAAAAAEBAAAAAAAAAAEBAAAAAAAAAQEAAAAAAAAAAQEBAAAAAAAAAAAAAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAABAQEBAQEBAQAAAAAAAAAAAAAAAAEBAAAAAAAAAAABAQAAAAAAAAABAQAAAAABAQEBAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEAAAAAAAABAQEBAAABAQEBAAAAAAAAAAAAAAEBAAAAAAAAAAAAAQEAAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAAEBAQAAAAAAAAAAAAEBAAAAAAAAAAAAAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAABAQAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAABAQEBAAABAQEBAAAAAAAAAAABAQEAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAQEAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAEBAAAAAAAAAAAAAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAAABAQAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAAAAQEAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAAAAAAAAAAAAAAEBAAAAAAAAAAEBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAQEBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA2qwCbLN5TUgAAAAASUVORK5CYII=
"}
<img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAoCAMAAAACNM4XAAAAGFBMVEUAAABQUFAAAAAAAAAAAAAAAAAAAAAAAABiRp8mAAAACHRSTlMA/wAAAAAAACXRGJEAABLzSURBVHjaAegSF+0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAQEAAAAAAAAAAAAAAAEBAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAAAAAAEBAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAQEBAQEBAQEBAQAAAAAAAAAAAAEBAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAAAAAEBAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAAAAAEBAQAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAQEAAAAAAAAAAAAAAAABAQEBAAAAAAAAAAAAAAAAAAABAQAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAQEBAQABAQEAAAAAAAAAAAABAQAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAEBAQEBAQEBAQAAAAAAAAAAAQEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAQEAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAQEBAQEBAQEBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAEBAQEBAQEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAABAQEBAQEBAQEBAQEBAQAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAABAQEBAAABAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAAAAAQEAAAAAAAAAAAABAQEAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAEBAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAEBAQAAAAABAQAAAAAAAAABAQAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAABAQEBAAABAQEBAAAAAAAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAABAQEBAQEAAAAAAAAAAAAAAAAAAAEBAAAAAAAAAAEBAAAAAAAAAQEAAAAAAAAAAQEBAAAAAAAAAAAAAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAABAQEBAQEBAQAAAAAAAAAAAAAAAAEBAAAAAAAAAAABAQAAAAAAAAABAQAAAAABAQEBAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEAAAAAAAABAQEBAAABAQEBAAAAAAAAAAAAAAEBAAAAAAAAAAAAAQEAAAAAAAAAAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAAEBAQAAAAAAAAAAAAEBAAAAAAAAAAAAAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAABAQAAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAABAQEBAAABAQEBAAAAAAAAAAABAQEAAAAAAAAAAAABAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAAAAAAAAAQEBAQAAAQEBAQAAAAAAAAAAAQEAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAAAAAAAAAEBAQEAAAEBAQEAAAAAAAAAAAEBAAAAAAAAAAAAAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQAAAAAAAAABAQEBAQEBAQEBAAAAAAAAAAABAQAAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAAAAQEAAAAAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAAAAAAAAAAAAAAEBAAAAAAAAAAEBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAQEBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA2qwCbLN5TUgAAAAASUVORK5CYII=" />

*
*
URL запроса: 	https://iself.tele2.kz/auth/checkMsisdn
Метод запроса: 	POST
Код состояния: 	HTTP/1.1 200 OK
Заголовки запроса 11:35:46.000
User-Agent:	Mozilla/5.0 (Windows NT 6.1; rv:42.0) Gecko/20100101 Firefox/42.0
Referer:	https://iself.tele2.kz/login
Pragma:	no-cache
Host:	iself.tele2.kz
DNT:	1
Content-Type:	application/json;charset=utf-8
Content-Length:	86
Connection:	keep-alive
Cache-Control:	no-cache
Accept-Language:	ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding:	gzip, deflate
Accept:	application/json, text/plain, /*
Отправленная кука
sid:	Z3d1r8ihXCFwOaS6v5ScgzKFSibftskP90EBzidaTcCqFpLpCaoQuSUd01g9bsQM1rJF1iNQVKn4hyxmrg8f7iLxiM5Ub1oqHwEQuhyJhu6n9HAuZZnl9ZiPJsDiWQlf
region:	almaty
NG_TRANSLATE_LANG_KEY:	"kz_KZ"
lang:	ru
_ym_visorc_32627145:	w
_ym_uid:	1472521515929940391
_ym_isad:	2
__utmz:	211774349.1472521518.1.1.utmcsr=w5conts.ddns.net:8080|utmccn=(referral)|utmcmd=referral|utmcct=/tst/sms/www/
__utmz:	196427305.1472566697.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)
__utmc:	211774349
__utmb:	211774349.2.10.1473653069
__utma:	211774349.1016757185.1472521518.1472951870.1473653069.4
__utma:	196427305.1295844629.1472566697.1472566697.1472566697.1
Тело запроса
{"msisdn":"7071355145","same_origin_token":"5496131068d7dcd774aff994421e10c222d65447"}
Заголовки ответа Δ1395мс
Transfer-Encoding:	chunked
Server:	nginx/0.7.61
Date:	Mon, 12 Sep 2016 04:35:47 GMT
Content-Type:	application/json; charset=UTF-8
Connection:	keep-alive
Полученная кука
sid:	Z3d1r8ihXCFwOaS6v5ScgzKFSibftskP90EBzidaTcCqFpLpCaoQuSUd01g9bsQM1rJF1iNQVKn4hyxmrg8f7iLxiM5Ub1oqHwEQuhyJhu6n9HAuZZnl9ZiPJsDiWQlf
Тело ответа Δ1мс
{"msisdn":"7071355145"}


URL запроса: 	https://iself.tele2.kz/auth/reg
Метод запроса: 	POST
Код состояния: 	HTTP/1.1 200 OK
Заголовки запроса 11:35:48.000
User-Agent:	Mozilla/5.0 (Windows NT 6.1; rv:42.0) Gecko/20100101 Firefox/42.0
Referer:	https://iself.tele2.kz/login
Pragma:	no-cache
Host:	iself.tele2.kz
DNT:	1
Content-Type:	application/json;charset=utf-8
Content-Length:	117
Connection:	keep-alive
Cache-Control:	no-cache
Accept-Language:	ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding:	gzip, deflate
Accept:	application/json, text/plain, /*
Отправленная кука
sid:	Z3d1r8ihXCFwOaS6v5ScgzKFSibftskP90EBzidaTcCqFpLpCaoQuSUd01g9bsQM1rJF1iNQVKn4hyxmrg8f7iLxiM5Ub1oqHwEQuhyJhu6n9HAuZZnl9ZiPJsDiWQlf
region:	almaty
NG_TRANSLATE_LANG_KEY:	"kz_KZ"
lang:	ru
_ym_visorc_32627145:	w
_ym_uid:	1472521515929940391
_ym_isad:	2
__utmz:	211774349.1472521518.1.1.utmcsr=w5conts.ddns.net:8080|utmccn=(referral)|utmcmd=referral|utmcct=/tst/sms/www/
__utmz:	196427305.1472566697.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)
__utmc:	211774349
__utmb:	211774349.2.10.1473653069
__utma:	211774349.1016757185.1472521518.1472951870.1473653069.4
__utma:	196427305.1295844629.1472566697.1472566697.1472566697.1
Тело запроса
{"msisdn":"7071355145","type":"sms","same_origin_token":"5496131068d7dcd774aff994421e10c222d65447","answer":"780054"}
Заголовки ответа Δ442мс
Transfer-Encoding:	chunked
Server:	nginx/0.7.61
Date:	Mon, 12 Sep 2016 04:35:47 GMT
Content-Type:	application/json; charset=UTF-8
Connection:	keep-alive
Полученная кука
sid:	Z3d1r8ihXCFwOaS6v5ScgzKFSibftskP90EBzidaTcCqFpLpCaoQuSUd01g9bsQM1rJF1iNQVKn4hyxmrg8f7iLxiM5Ub1oqHwEQuhyJhu6n9HAuZZnl9ZiPJsDiWQlf
Тело ответа Δ0мс
{"oResult":["0"],"type":"sms"}

Личный кабинет интернет-обслуживания — самый быстрый способ управлять услугами связи.
Регистрация

На указанный Вами номер было отправлено SMS с новым паролем.

*/
